/*
196. åˆ é™¤é‡å¤çš„ç”µå­é‚®ç®±
ç¼–å†™ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œæ¥åˆ é™¤ Person è¡¨ä¸­æ‰€æœ‰é‡å¤çš„ç”µå­é‚®ç®±ï¼Œé‡å¤çš„é‚®ç®±é‡Œåªä¿ç•™ Id æœ€å° çš„é‚£ä¸ªã€‚

+----+------------------+
| Id | Email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
| 3  | john@example.com |
+----+------------------+
Id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
ä¾‹å¦‚ï¼Œåœ¨è¿è¡Œä½ çš„æŸ¥è¯¢è¯­å¥ä¹‹åŽï¼Œä¸Šé¢çš„ Person è¡¨åº”è¿”å›žä»¥ä¸‹å‡ è¡Œ:

+----+------------------+
| Id | Email            |
+----+------------------+
| 1  | john@example.com |
| 2  | bob@example.com  |
+----+------------------+


æç¤ºï¼š

æ‰§è¡Œ SQL ä¹‹åŽï¼Œè¾“å‡ºæ˜¯æ•´ä¸ª Person è¡¨ã€‚
ä½¿ç”¨ delete è¯­å¥ã€‚
 */

/*

æ–¹æ³•ï¼šä½¿ç”¨ DELETE å’Œ WHERE å­å¥
ç®—æ³•

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼Œå°†æ­¤è¡¨ä¸Žå®ƒè‡ªèº«åœ¨ç”µå­é‚®ç®±åˆ—ä¸­è¿žæŽ¥èµ·æ¥ã€‚

MySQL

SELECT p1.*
FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email
;
ç„¶åŽæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å…¶ä»–è®°å½•ä¸­å…·æœ‰ç›¸åŒç”µå­é‚®ä»¶åœ°å€çš„æ›´å¤§ IDã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç»™ WHERE å­å¥æ·»åŠ ä¸€ä¸ªæ–°çš„æ¡ä»¶ã€‚

MySQL

SELECT p1.*
FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id
;
å› ä¸ºæˆ‘ä»¬å·²ç»å¾—åˆ°äº†è¦åˆ é™¤çš„è®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å°†è¯¥è¯­å¥æ›´æ”¹ä¸º DELETEã€‚

MySQL

DELETE p1 FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id

 */

/*

 æ–¹æ³•ï¼šä½¿ç”¨ DELETE å’Œ WHERE å­å¥
ç®—æ³•

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ï¼Œå°†æ­¤è¡¨ä¸Žå®ƒè‡ªèº«åœ¨ç”µå­é‚®ç®±åˆ—ä¸­è¿žæŽ¥èµ·æ¥ã€‚

MySQL

SELECT p1.*
FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email
;
ç„¶åŽæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å…¶ä»–è®°å½•ä¸­å…·æœ‰ç›¸åŒç”µå­é‚®ä»¶åœ°å€çš„æ›´å¤§ IDã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç»™ WHERE å­å¥æ·»åŠ ä¸€ä¸ªæ–°çš„æ¡ä»¶ã€‚

MySQL

SELECT p1.*
FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id
;
å› ä¸ºæˆ‘ä»¬å·²ç»å¾—åˆ°äº†è¦åˆ é™¤çš„è®°å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆå¯ä»¥å°†è¯¥è¯­å¥æ›´æ”¹ä¸º DELETEã€‚

MySQL

DELETE p1 FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id

å®˜æ–¹sqlæ˜¯ä¸‹é¢è¿™æ ·çš„ðŸ‘‡

MySQL

DELETE p1 FROM Person p1,
    Person p2
WHERE
    p1.Email = p2.Email AND p1.Id > p2.Id
å½“ç„¶è¿™ä¸ªsqlæ˜¯å¾ˆokçš„ï¼Œç®€æ´æ¸…æ™°ï¼Œä¸”ç”¨äº†è‡ªè¿žæŽ¥çš„æ–¹å¼ã€‚
æœ‰æ…¢æŸ¥è¯¢ä¼˜åŒ–ç»éªŒçš„åŒå­¦ä¼šæ¸…æ¥šï¼Œåœ¨å®žé™…ç”Ÿäº§ä¸­ï¼Œé¢å¯¹åƒä¸‡ä¸Šäº¿çº§åˆ«çš„æ•°æ®ï¼Œè¿žæŽ¥çš„æ•ˆçŽ‡å¾€å¾€æœ€é«˜ï¼Œå› ä¸ºç”¨åˆ°ç´¢å¼•çš„æ¦‚çŽ‡è¾ƒé«˜ã€‚

å› æ­¤ï¼Œå»ºè®®å­¦ä¹ ä½¿ç”¨å®˜æ–¹çš„é¢˜è§£ï¼Œä½†æ˜¯æœ‰ä¸¤ç‚¹ï¼Œå¯èƒ½éœ€è¦å†è§£é‡Šä¸‹ï¼š

1ã€DELETE p1

åœ¨DELETEå®˜æ–¹æ–‡æ¡£ä¸­ï¼Œç»™å‡ºäº†è¿™ä¸€ç”¨æ³•ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªDELETEè¯­å¥ðŸ‘‡

DELETE t1 FROM t1 LEFT JOIN t2 ON t1.id=t2.id WHERE t2.id IS NULL;

è¿™ç§DELETEæ–¹å¼å¾ˆé™Œç”Ÿï¼Œç«Ÿç„¶å’ŒSELETEçš„å†™æ³•ç±»ä¼¼ã€‚å®ƒæ¶‰åŠåˆ°t1å’Œt2ä¸¤å¼ è¡¨ï¼ŒDELETE t1è¡¨ç¤ºè¦åˆ é™¤t1çš„ä¸€äº›è®°å½•ï¼Œå…·ä½“åˆ å“ªäº›ï¼Œå°±çœ‹WHEREæ¡ä»¶ï¼Œæ»¡è¶³å°±åˆ ï¼›

è¿™é‡Œåˆ çš„æ˜¯t1è¡¨ä¸­ï¼Œè·Ÿt2åŒ¹é…ä¸ä¸Šçš„é‚£äº›è®°å½•ã€‚

æ‰€ä»¥ï¼Œå®˜æ–¹sqlä¸­ï¼ŒDELETE p1å°±è¡¨ç¤ºä»Žp1è¡¨ä¸­åˆ é™¤æ»¡è¶³WHEREæ¡ä»¶çš„è®°å½•ã€‚

2ã€p1.Id > p2.Id

ç»§ç»­ä¹‹å‰ï¼Œå…ˆç®€å•çœ‹ä¸€ä¸‹è¡¨çš„è¿žæŽ¥è¿‡ç¨‹ï¼Œè¿™ä¸ªæžæ‡‚äº†ï¼Œç†è§£WHEREæ¡ä»¶å°±ç®€å•äº†ðŸ‘‡

a. ä»Žé©±åŠ¨è¡¨ï¼ˆå·¦è¡¨ï¼‰å–å‡ºNæ¡è®°å½•ï¼›
b. æ‹¿ç€è¿™Næ¡è®°å½•ï¼Œä¾æ¬¡åˆ°è¢«é©±åŠ¨è¡¨ï¼ˆå³è¡¨ï¼‰æŸ¥æ‰¾æ»¡è¶³WHEREæ¡ä»¶çš„è®°å½•ï¼›

æ‰€ä»¥ï¼Œå®˜æ–¹sqlçš„è¿‡ç¨‹å°±æ˜¯ðŸ‘‡

å…ˆæŠŠPersonè¡¨æ¬è¿‡æ¥( â€¢Ì€âˆ€â€¢Ì )


a. ä»Žè¡¨p1å–å‡º3æ¡è®°å½•ï¼›
b. æ‹¿ç€ç¬¬1æ¡è®°å½•åŽ»è¡¨p2æŸ¥æ‰¾æ»¡è¶³WHEREçš„è®°å½•ï¼Œä»£å…¥è¯¥æ¡ä»¶p1.Email = p2.Email AND p1.Id > p2.IdåŽï¼Œå‘çŽ°æ²¡æœ‰æ»¡è¶³çš„ï¼Œæ‰€ä»¥ä¸ç”¨åˆ æŽ‰è®°å½•1ï¼›
c. è®°å½•2åŒç†ï¼›
d. æ‹¿ç€ç¬¬3æ¡è®°å½•åŽ»è¡¨p2æŸ¥æ‰¾æ»¡è¶³WHEREçš„è®°å½•ï¼Œå‘çŽ°æœ‰ä¸€æ¡è®°å½•æ»¡è¶³ï¼Œæ‰€ä»¥è¦ä»Žp1åˆ æŽ‰è®°å½•3ï¼›
e. 3æ¡è®°å½•éåŽ†å®Œï¼Œåˆ æŽ‰äº†1æ¡è®°å½•ï¼Œè¿™ä¸ªDELETEä¹Ÿå°±ç»“æŸäº†ã€‚

 */

delete p1 from Person as p1,Person p2 where p1.Email = p2.Email and p1.Id > p2.Id